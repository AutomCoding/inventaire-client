#!/usr/bin/env zsh

# Exit on error (cf http://jvns.ca/blog/2017/03/26/bash-quirks/)
set -e

echo -e '\e[0;30mupdating i18n\e[0m'
./scripts/build_i18n
# should run before brunch build
./scripts/update_languages_stats

echo -e '\e[0;30mbrunch build --production\e[0m'
brunch build --production
./scripts/build_index

echo -e '\e[0;30mgzip js and css files\e[0m'
./scripts/set_content_hash_cache_bust
source ./scripts/init_gzip_utils
gzipkeepall public/json
gzipkeepall public/js/moment

echo -e '\e[0;30mgzip index.html\e[0m'
gzip -9kf public/index.html
echo -e '\e[0;30mgzip robots.txt\e[0m'
gzip -9kf public/robots.txt

./scripts/weight_watcher
