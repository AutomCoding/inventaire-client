#!/usr/bin/env bash

# set browser.fs=false to work around parcel-bundler "Cannot statically evaluate fs argument" issue
# see https://github.com/parcel-bundler/parcel/pull/523#issue-161973498
disable_browser_fs(){
  cat $1 | jq '.browser.fs = false' > $1.fixed
  mv $1.fixed $1
}

disable_browser_fs node_modules/handlebars/package.json

npm run update-mentions
./scripts/build_i18n

# Make git hooks trackable (see https://stackoverflow.com/a/4457124/3324977)
rm -rf .git/hooks
ln -s .githooks .git/hooks

mkdir -p ./public
ln -s ./public/dist/index.html ./public/index.html

curl -sk https://piwik.allmende.io/piwik.js > ./app/assets/piwik.js
