#!/usr/bin/env zsh

# Exit on error (cf http://jvns.ca/blog/2017/03/26/bash-quirks/)
set -e

# If public/js/app.js already exist, assume that it's a re-install
# and that all the following isn't needed
[ -e public/js/app.js ] && exit 0

./scripts/slim_packages.coffee
mkdir -p ./vendor/js ./vendor/css ./public/sitemaps ./public/json
./scripts/install_external_js_modules
./scripts/update_mentions.coffee

bower install

npm run patches
./scripts/mv_font_awesome_fonts
./scripts/mv_moment_locales

# need to build once to make the public folder available
./node_modules/brunch/bin/brunch build

git clone -b i18n https://github.com/inventaire/inventaire-client.git ./public/i18n

# The `coffee` executable is already made accessible to this present script
# (cf http://www.2ality.com/2016/01/locally-installed-npm-executables.html)
# but not nested scripts, thus the need to use `npm run`
npm run update-i18n
